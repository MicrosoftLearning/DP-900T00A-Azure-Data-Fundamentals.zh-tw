---
ms.openlocfilehash: aa7ddb2f2ce7709064cf5157f709fc1eff52cff7
ms.sourcegitcommit: e739004291428ce83f14b9d49f1e9dfaa3762dde
ms.translationtype: HT
ms.contentlocale: zh-TW
ms.lasthandoff: 02/05/2022
ms.locfileid: "138050780"
---
## <a name="follow-redirects"></a>遵循重新導向

Node `http` 和 `https` 模組的置放取代項目，可自動遵循重新導向。

[![npm 版本](https://img.shields.io/npm/v/follow-redirects.svg)](https://www.npmjs.com/package/follow-redirects)
[![組建狀態](https://github.com/follow-redirects/follow-redirects/workflows/CI/badge.svg)](https://github.com/follow-redirects/follow-redirects/actions)
[![涵蓋範圍狀態](https://coveralls.io/repos/follow-redirects/follow-redirects/badge.svg?branch=master)](https://coveralls.io/r/follow-redirects/follow-redirects?branch=master)
[![npm 下載](https://img.shields.io/npm/dm/follow-redirects.svg)](https://www.npmjs.com/package/follow-redirects)
[![GitHub 贊助者](https://img.shields.io/static/v1?label=Sponsor&message=%F0%9F%92%96&logo=GitHub)](https://github.com/sponsors/RubenVerborgh)

`follow-redirects` 會提供[要求](https://nodejs.org/api/http.html#http_http_request_options_callback)和[取得](https://nodejs.org/api/http.html#http_http_get_options_callback)方法，這些方法的運作模式與原生 [HTTP](https://nodejs.org/api/http.html#http_http_request_options_callback) 和 [HTTPS](https://nodejs.org/api/https.html#https_https_request_options_callback) 模組上顯示的相同，唯一的例外是它們會順暢地遵循重新導向。

```javascript
const { http, https } = require('follow-redirects');

http.get('http://bit.ly/900913', response => {
  response.on('data', chunk => {
    console.log(chunk);
  });
}).on('error', err => {
  console.error(err);
});
```

您可以透過 `response` 上的 `responseUrl` 屬性檢查最終重新導向 URL。
如果未發生重新導向，`responseUrl` 就是原始的要求 URL。

```javascript
const request = https.request({
  host: 'bitly.com',
  path: '/UHfDGO',
}, response => {
  console.log(response.responseUrl);
  // 'http://duckduckgo.com/robots.txt'
});
request.end();
```

## <a name="options"></a>選項
### <a name="global-options"></a>全域選項
您可以直接在 `follow-redirects` 模組上設定全域選項：

```javascript
const followRedirects = require('follow-redirects');
followRedirects.maxRedirects = 10;
followRedirects.maxBodyLength = 20 * 1024 * 1024; // 20 MB
```

可支援以下全域選項：

- `maxRedirects` (預設值：`21`) – 設定可執行的重新導向次數上限；如果超過就會發出錯誤。

- `maxBodyLength` (預設值：10 MB) – 設定要求本文的大小上限；如果超過就會發出錯誤。

### <a name="per-request-options"></a>每個要求選項
傳遞 `options` 物件後即可設定每個要求選項：

```javascript
const url = require('url');
const { http, https } = require('follow-redirects');

const options = url.parse('http://bit.ly/900913');
options.maxRedirects = 10;
options.beforeRedirect = (options, { headers }) => {
  // Use this to adjust the request options upon redirecting,
  // to inspect the latest response headers,
  // or to cancel the request by throwing an error
  if (options.hostname === "example.com") {
    options.auth = "user:password";
  }
};
http.request(options);
```

除了[標準 HTTP](https://nodejs.org/api/http.html#http_http_request_options_callback) 和 [HTTPS 選項](https://nodejs.org/api/https.html#https_https_request_options_callback)之外，也支援以下每個要求選項：
- `followRedirects` (預設值：`true`) – 是否應遵循重新導向。

- `maxRedirects` (預設值：`21`) – 設定可執行的重新導向次數上限；如果超過就會發出錯誤。

- `maxBodyLength` (預設值：10 MB) – 設定要求本文的大小上限；如果超過就會發出錯誤。

- `beforeRedirect` (預設值：`undefined`) – 選擇性地在重新導向時變更要求 `options`，或擲回錯誤以中止要求。

- `agents` (預設值：`undefined`) – 設定每個通訊協定的 `agent` 選項，因為 HTTP 和 HTTPS 使用不同的代理程式。 值範例： `{ http: new http.Agent(), https: new https.Agent() }`

- `trackRedirects` (預設值：`false`) – 是否要將重新導向的回應詳情儲存到回應物件的 `redirects` 陣列中。


### <a name="advanced-usage"></a>進階使用方式
在預設情況下，`follow-redirects` 將使用 [`http`](https://nodejs.org/api/http.html) 和 [`https`](https://nodejs.org/api/https.html) 的 Node.js 預設實作。
若要啟用快取和/或中繼要求追蹤等功能，您可能會想改用 `follow-redirects` 來包裝自訂通訊協定實作：

```javascript
const { http, https } = require('follow-redirects').wrap({
  http: require('your-custom-http'),
  https: require('your-custom-https'),
});
```

這類自訂通訊協定只需要實作 `request` 方法即可。

## <a name="browser-usage"></a>瀏覽器使用量

根據預設，瀏覽器的運作方式會讓 `http` 和 `https` 對等瀏覽器執行重新導向。

若透過這種方式要求 `follow-redirects`：
```javascript
const http = require('follow-redirects/http');
const https = require('follow-redirects/https');
```
您可以輕鬆地指示 webpack 和朋友以內建版本取代 `follow-redirect`：

```json
{
  "follow-redirects/http"  : "http",
  "follow-redirects/https" : "https"
}
```

## <a name="contributing"></a>參與

您可以隨時發出提取要求。 請先[提出問題](https://github.com/follow-redirects/follow-redirects/issues)並詳細說明您的提案後，再投入您寶貴的時間。 其他功能和錯誤修正應附上測試結果。 您可以使用簡單的 `npm test` 命令在本機執行測試套件。

## <a name="debug-logging"></a>偵錯記錄

`follow-redirects` 會使用絕佳的[偵錯](https://www.npmjs.com/package/debug)功能來記錄。 若要開啟記錄功能，只需透過此模組設定偵錯輸出的環境變數 `DEBUG=follow-redirects` 即可。 執行測試套件時，有時設定 `DEBUG=*` 來查看 Express 伺服器的輸出會十分有利。

## <a name="authors"></a>Authors

- [Ruben Verborgh](https://ruben.verborgh.org/)
- [Olivier Lalonde](mailto:olalonde@gmail.com)
- [James Talmage](mailto:james@talmage.io)

## <a name="license"></a>授權

[MIT 授權](https://github.com/follow-redirects/follow-redirects/blob/master/LICENSE)
