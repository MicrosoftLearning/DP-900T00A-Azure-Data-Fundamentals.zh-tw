---
ms.openlocfilehash: 6aae1c88465791540ed5192f26e8f48b83eb2b47
ms.sourcegitcommit: e739004291428ce83f14b9d49f1e9dfaa3762dde
ms.translationtype: HT
ms.contentlocale: zh-TW
ms.lasthandoff: 02/05/2022
ms.locfileid: "138050696"
---
# <a name="node-jwa-build-statushttpstravis-ciorgbrianloveswordsnode-jwa"></a>node-jwa [![組建狀態](https://travis-ci.org/brianloveswords/node-jwa.svg?branch=master)](https://travis-ci.org/brianloveswords/node-jwa)

(目前完全) 聚焦於 [JSON Web 簽章](http://self-issued.info/docs/draft-ietf-jose-json-web-signature.html)所需演算法的 [JSON Web Algorithm](http://tools.ietf.org/id/draft-ietf-jose-json-web-algorithms-08.html) 實作。

此程式庫支援所有必要、建議使用和可供選用的 JWS 密碼編譯演算法：

alg 參數值 | 數位簽章或 MAC 演算法
----------------|----------------------------
HS256 | 使用 SHA-256 雜湊演算法的 HMAC
HS384 | 使用 SHA-384 雜湊演算法的 HMAC
HS512 | 使用 SHA-512 雜湊演算法的 HMAC
RS256 | 使用 SHA-256 雜湊演算法的 RSASSA
RS384 | 使用 SHA-384 雜湊演算法的 RSASSA
RS512 | 使用 SHA-512 雜湊演算法的 RSASSA
PS256 | 使用 SHA-256 雜湊演算法的 RSASSA-PSS
PS384 | 使用 SHA-384 雜湊演算法的 RSASSA-PSS
PS512 | 使用 SHA-512 雜湊演算法的 RSASSA-PSS
ES256 | 使用 P-256 曲線和 SHA-256 雜湊演算法的 ECDSA
ES384 | 使用 P-384 曲線和 SHA-384 雜湊演算法的 ECDSA
ES512 | 使用 P-521 曲線和 SHA-512 雜湊演算法的 ECDSA
無 | 未包含數位簽章或 MAC 值

請注意，PS* 僅適用於 Node 6.12+ (7.x 除外)。

# <a name="requirements"></a>規格需求

若要執行測試，您必須使用最新版本的 OpenSSL。 **OS X 隨附的版本 (2 月 8 日發行的 0.9.8r 版 OpenSSL
2011) 不夠新**，因為它並未全面支援 ECDSA 金鑰。 您必須使用 1.0.0 以上的版本；我使用 2012 年 5 月 10 日發行的 1.0.1c 版 OpenSSL 進行測試。

# <a name="testing"></a>測試

若要執行測試，請

```bash
$ npm test
```

這會產生許多將用於測試的金鑰組。 如果您希望產生新的金鑰組，請在執行 `npm test` 之前再次執行 `make clean`。

## <a name="methodology"></a>方法

針對每個 RSA 和 ECDSA 演算法，我繁衍 `openssl dgst -sign` 以測試 OpenSSL 簽署→ JS 驗證，並繁衍 `openssl dgst -verify` 以測試 JS 簽署 → OpenSSL 驗證。

# <a name="usage"></a>使用方式

## <a name="jwaalgorithm"></a>jwa(演算法)

使用 `sign` 和 `verify` 方法來為演算法建立新的 `jwa` 物件。 在上述資料表中可找到演算法的有效值 (`'HS256'`、`'HS384'` 等)，而且有區分大小寫。 若您傳遞不正確的演算法值，將會擲回 `TypeError`。


## <a name="jwasigninput-secretorprivatekey"></a>jwa#sign(輸入, secretOrPrivateKey)

使用 HMAC 演算法的秘密或 RSA 和 ECDSA 演算法的私密金鑰，來簽署一些輸入。

如果輸入還不是字串或緩衝區，則系統會呼叫 `JSON.stringify` 以強制其轉型。

使用 HMAC 演算法時，`secretOrPrivateKey` 應為字串或緩衝區。 使用 ECDSA 和 RSA 時，這個值應為 PEM 編碼格式 **私密** 金鑰的字串。

輸出已進行 [base64url](http://en.wikipedia.org/wiki/Base64#URL_applications) 格式化。 這是為了方便起見，因為 JWS 預設這種格式的簽章。 如果您的應用程式需要不同格式的輸出，[請提出問題](https://github.com/brianloveswords/node-jwa/issues)。 同時，您可利用 [brianloveswords/base64url](https://github.com/brianloveswords/base64url) 來解碼簽章。

自 nodejs v0.11.8 開始，支援 SPKAC。 如果您的 nodeJs 版本符合要求，便可以傳遞物件 `{ key: '..', passphrase: '...' }`。


## <a name="jwaverifyinput-signature-secretorpublickey"></a>jwa#verify(輸入, 簽章, secretOrPublicKey)

驗證簽章。 傳回 `true` 或 `false`。

`signature` 應為 base64url 編碼字串。

使用 HMAC 演算法時，`secretOrPublicKey` 應為字串或緩衝區。 使用 ECDSA 和 RSA 時，這個值應為 PEM 編碼格式 **私密** 金鑰的字串。


# <a name="example"></a>範例

HMAC
```js
const jwa = require('jwa');

const hmac = jwa('HS256');
const input = 'super important stuff';
const secret = 'shhhhhh';

const signature = hmac.sign(input, secret);
hmac.verify(input, signature, secret) // === true
hmac.verify(input, signature, 'trickery!') // === false
```

使用金鑰
```js
const fs = require('fs');
const jwa = require('jwa');
const privateKey = fs.readFileSync(__dirname + '/ecdsa-p521-private.pem');
const publicKey = fs.readFileSync(__dirname + '/ecdsa-p521-public.pem');

const ecdsa = jwa('ES512');
const input = 'very important stuff';

const signature = ecdsa.sign(input, privateKey);
ecdsa.verify(input, signature, publicKey) // === true
```
## <a name="license"></a>授權

MIT

```
Copyright (c) 2013 Brian J. Brennan

Permission is hereby granted, free of charge, to any person obtaining a
copy of this software and associated documentation files (the
"Software"), to deal in the Software without restriction, including
without limitation the rights to use, copy, modify, merge, publish,
distribute, sublicense, and/or sell copies of the Software, and to
permit persons to whom the Software is furnished to do so, subject to
the following conditions:

The above copyright notice and this permission notice shall be included
in all copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS
OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE
LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION
OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION
WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
```
