---
ms.openlocfilehash: 8013ef1413fb83a07c8c31eb731be49ba57bbb66
ms.sourcegitcommit: e739004291428ce83f14b9d49f1e9dfaa3762dde
ms.translationtype: HT
ms.contentlocale: zh-TW
ms.lasthandoff: 02/05/2022
ms.locfileid: "138050840"
---
## <a name="azure-identity-client-library-for-javascript"></a>適用於 JavaScript 的 Azure 身分識別用戶端程式庫

Azure 身分識別程式庫提供 Azure Active Directory 權杖驗證支援，在所有 Azure SDK 上均適用。 它提供一組 [TokenCredential](https://docs.microsoft.com/javascript/api/@azure/core-auth/tokencredential) 實作，可用於建構支援 AAD 權杖驗證的 Azure SDK 用戶。

您可在 [Azure 身分識別範例頁面](https://github.com/Azure/azure-sdk-for-js/blob/hotfix/identity_1.3.0/sdk/identity/identity/samples/AzureIdentityExamples.md)中參考各種認證的範例

[原始程式碼](https://github.com/Azure/azure-sdk-for-js/tree/master/sdk/identity/identity) | [套件 (npm)](https://www.npmjs.com/package/@azure/identity) | [API 參考文件](https://docs.microsoft.com/javascript/api/@azure/identity) | [產品文件](https://azure.microsoft.com/services/active-directory/) | [範例](https://github.com/Azure/azure-sdk-for-js/blob/master/sdk/identity/identity/samples)

## <a name="getting-started"></a>開始使用

### <a name="currently-supported-environments"></a>目前支援的環境

- [LTS 版本的 Node.js](https://nodejs.org/about/releases/)
- Safari、Chrome、Edge 和 Firefox 的最新版本。
  - 注意：注意：在此程式庫中匯出的不同認證之間，`InteractiveBrowserCredential` 是瀏覽器唯一支援的認證。

### <a name="install-the-package"></a>安裝套件

使用 `npm` 安裝 Azure 身分識別：

```sh
npm install --save @azure/identity
```

### <a name="prerequisites"></a>Prerequisites

- Node.js 8 LTS 或更新版本。
- [Azure 訂用帳戶](https://azure.microsoft.com/free/)。
- [Azure CLI][azure_cli] 也可在開發環境中驗證和管理帳戶角色。

### <a name="authenticate-the-client-in-development-environment"></a>在開發環境中驗證用戶端

雖然我們建議您在生產應用程式中使用受控識別或服務主體驗證，但開發人員在本機偵錯和執行程式碼時，通常會使用自己的帳戶來驗證對 Azure 服務的呼叫。 有數個開發人員工具可供您在開發環境中執行此驗證。

#### <a name="authenticating-via-visual-studio-code"></a>透過 Visual Studio Code 進行驗證

使用 Visual Studio Code 的開發人員可利用 [Azure 帳戶延伸模組](https://marketplace.visualstudio.com/items?itemName=ms-vscode.azure-account)，透過 IDE 進行驗證。 之後，使用 `DefaultAzureCredential` 或 `VisualStudioCodeCredential` 的應用程式便可在本機執行時，利用此帳戶來驗證應用程式中的呼叫。

若要在 Visual Studio Code 中進行驗證，請先確認已安裝 [Azure 帳戶延伸模組](https://marketplace.visualstudio.com/items?itemName=ms-vscode.azure-account)。 安裝延伸模組之後，請按下 `F1`，以開啟命令選擇區並執行 `Azure: Sign In` 命令。

![Visual Studio Code 帳戶登入][vscodelogincommand_image]

#### <a name="authenticating-via-the-azure-cli"></a>透過 Azure CLI 進行驗證

使用 `AzureCliCredential` 而非直接使用或透過 `DefaultAzureCredential` 的應用程式，可在本機執行時利用 Azure CLI 帳戶驗證應用程式中的呼叫。

若要利用 [Azure CLI][azure_cli] 進行驗證，使用者可執行命令 `az login`。 針對使用預設網路瀏覽器在系統上執行的使用者，Azure cli 會啟動瀏覽器來驗證使用者。

![Azure CLI 帳戶登入][azureclilogin_image]

針對沒有預設網頁瀏覽器的系統，`az login` 命令會採用裝置程式碼驗證流程。 使用者也可以強制 Azure CLI 採用裝置程式碼流程，而不是指定 `--use-device-code` 引數來啟動瀏覽器。

![Azure CLI 帳戶裝置程式碼登入][azureclilogindevicecode_image]

### <a name="authenticate-the-client-in-browsers"></a>在瀏覽器中驗證用戶端

若您要在網路瀏覽器中驗證 Azure SDK，我們目前提供 `InteractiveBrowserCredential`，其可設定為利用重新導向或快顯來完成驗證流程。 您必須先在 Web 應用程式入口網站中[建立Azure 應用程式註冊](https://docs.microsoft.com/azure/active-directory/develop/scenario-spa-app-registration)。

## <a name="key-concepts"></a>重要概念

如果這是您第一次使用 `@azure/identity` 或 Microsoft 身分識別平台 (Azure Active Directory)，建議您先參閱[使用 `@azure/identity` Microsoft 身分識別平台](https://github.com/Azure/azure-sdk-for-js/blob/master/documentation/using-azure-identity.md)。 此文件可幫助您深入瞭解平台及如何正確設定 Azure 帳戶。

### <a name="credentials"></a>認證

認證指的是包含或可取得服務用戶端所需資料以驗證要求的類別。 Azure SDK 上的服務用戶端在建構時會接受認證，而服務用戶端會使用這些認證來驗證服務的要求。

Azure 身分識別程式庫著重於透過 Azure Active Directory 進行的 OAuth 驗證，並提供各種認證類別，能夠取得 AAD 權杖來驗證服務要求。 此程式庫中的所有認證類別都是 [TokenCredential](https://github.com/Azure/azure-sdk-for-js/blob/master/sdk/core/core-auth/src/tokenCredential.ts) 抽象類別的實作，其中的任何一個類別都可用於建構可使用 TokenCredential 進行驗證的服務用戶端。

請參閱[認證類別](#credential-classes)。

### <a name="defaultazurecredential"></a>DefaultAzureCredential

`DefaultAzureCredential` 適用於大部分的案例，其中應用程式最終會在 Azure 雲端中執行。 這是因為 `DefaultAzureCredential` 會結合常用來在部署時用來驗證的認證，以及用來在開發環境中進行驗證的認證。 `DefaultAzureCredential` 會嘗試依序透過下列機制進行驗證。

![DefaultAzureCredential 驗證流程][defaultauthflow_image]

- 環境 - `DefaultAzureCredential` 會透過[環境變數](#environment-variables)讀取指定的帳戶資訊，並以此進行驗證。
- 受控識別：如果應用程式部署到已啟用受控識別的 Azure 主機，則 `DefaultAzureCredential` 將會使用該帳戶進行驗證。
- Visual Studio Code：如果開發人員已透過 Visual Studio Code Azure 帳戶外掛程式進行驗證，則 `DefaultAzureCredential` 將會使用該帳戶進行驗證。
- Azure CL - 如果開發人員已透過 Azure CLI `az login` 命令驗證帳戶，則 `DefaultAzureCredential` 會使用該帳戶進行驗證。

## <a name="environment-variables"></a>環境變數

`DefaultAzureCredential` 和 `EnvironmentCredential` 可以使用環境變數進行設定。 每一種驗證類型都需要特定變數的值：

#### <a name="service-principal-with-secret"></a>具備密碼的服務主體

| 變數名稱         | value                                                 |
| --------------------- | ----------------------------------------------------- |
| `AZURE_CLIENT_ID`     | Azure Active Directory 應用程式的識別碼           |
| `AZURE_TENANT_ID`     | 應用程式的 Azure Active Directory 租用戶的識別碼 |
| `AZURE_CLIENT_SECRET` | 其中一個應用程式的用戶端密碼               |

#### <a name="service-principal-with-certificate"></a>具有憑證的服務主體

| 變數名稱                   | value                                                                                      |
| ------------------------------- | ------------------------------------------------------------------------------------------ |
| `AZURE_CLIENT_ID`               | Azure Active Directory 應用程式的識別碼                                                |
| `AZURE_TENANT_ID`               | 應用程式的 Azure Active Directory 租用戶的識別碼                                      |
| `AZURE_CLIENT_CERTIFICATE_PATH` | 存取 PEM 編碼憑證檔案的路徑，包括私密金鑰 (不需密碼保護) |

#### <a name="username-and-password"></a>使用者名稱和密碼

| 變數名稱     | value                                       |
| ----------------- | ------------------------------------------- |
| `AZURE_CLIENT_ID` | Azure Active Directory 應用程式的識別碼 |
| `AZURE_USERNAME`  | 使用者名稱 (通常是電子郵件地址)       |
| `AZURE_PASSWORD`  | 該使用者的密碼                        |

系統會依上述順序嘗試進行設定。 例如，如果用戶端同時具有密碼和憑證的值，則系統會採用用戶端密碼。

## <a name="examples"></a>範例

您可在 [Azure 身分識別範例頁面](https://github.com/Azure/azure-sdk-for-js/blob/hotfix/identity_1.3.0/sdk/identity/identity/samples/AzureIdentityExamples.md)中參考更多使用各種認證的範例

### <a name="authenticating-with-the-defaultazurecredential"></a>使用 `DefaultAzureCredential` 進行驗證

此範例示範如何使用 `DefaultAzureCredential` 從 [@azure/keyvault-keys](https://www.npmjs.com/package/@azure/keyvault-keys) 用戶端程式庫驗證 `KeyClient`。

```javascript
// The default credential first checks environment variables for configuration as described above.
// If environment configuration is incomplete, it will try managed identity.

// Azure Key Vault service to use
const { KeyClient } = require("@azure/keyvault-keys");

// Azure authentication library to access Azure Key Vault
const { DefaultAzureCredential } = require("@azure/identity");

// Azure SDK clients accept the credential as a parameter
const credential = new DefaultAzureCredential();

// Create authenticated client
const client = new KeyClient(vaultUrl, credential);

// Use service from authenticated client
const getResult = await client.getKey("MyKeyName");
```

### <a name="specifying-a-user-assigned-managed-identity-with-the-defaultazurecredential"></a>使用 `DefaultAzureCredential` 來指定使用者指派的受控身分識別

相對常見的案例是，使用使用者指派的 Azure 資源受控身分識別進行驗證。 探索[使用 DefaultAzureCredential 驗證使用者指派的受控身分識別的範例](https://github.com/Azure/azure-sdk-for-js/blob/hotfix/identity_1.3.0/sdk/identity/identity/samples/AzureIdentityExamples.md#authenticating-a-user-assigned-managed-identity-with-defaultazurecredential)，以瞭解如何以相對直覺的方式使用環境變數，或在程式碼中進行設定。

### <a name="define-a-custom-authentication-flow-with-the-chainedtokencredential"></a>使用 `ChainedTokenCredential` 定義自訂驗證流程

雖然 `DefaultAzureCredential` 通常是開發 Azure 應用程式最快速的方式，但進階使用者可能會希望在驗證時自訂認證。 `ChainedTokenCredential` 可供使用者結合多個認證實例，以定義自訂的認證鏈結。 此範例示範如何建立 `ChainedTokenCredential`，並藉此嘗試利用 `ClientSecretCredential` 的兩個不同設定的實例進行驗證，然後從 [@azure/keyvault-keys](https://www.npmjs.com/package/@azure/keyvault-keys) 驗證 `KeyClient`：

```javascript
const { ClientSecretCredential, ChainedTokenCredential } = require("@azure/identity");

// When an access token is requested, the chain will try each
// credential in order, stopping when one provides a token
const firstCredential = new ClientSecretCredential(tenantId, clientId, clientSecret);
const secondCredential = new ClientSecretCredential(tenantId, anotherClientId, anotherSecret);
const credentialChain = new ChainedTokenCredential(firstCredential, secondCredential);

// The chain can be used anywhere a credential is required
const { KeyClient } = require("@azure/keyvault-keys");
const client = new KeyClient(vaultUrl, credentialChain);
```

## <a name="managed-identity-support"></a>受控識別支援

可透過 `DefaultAzureCredential` 或下列 Azure 主機的 `ManagedIdentityCredential` 認證類別，支援[受控識別驗證](https://docs.microsoft.com/azure/active-directory/managed-identities-azure-resources/overview)：

- [Azure 虛擬機器](https://docs.microsoft.com/azure/active-directory/managed-identities-azure-resources/how-to-use-vm-token)
- [Azure App Service](https://docs.microsoft.com/azure/app-service/overview-managed-identity)
- [Azure Kubernetes Service](https://docs.microsoft.com/azure/aks/use-managed-identity)
- [Azure Cloud Shell](https://docs.microsoft.com/azure/cloud-shell/msi-authorization)
- [Azure Arc](https://docs.microsoft.com/azure/azure-arc/servers/managed-identity-authentication)
- [Azure Service Fabric](https://docs.microsoft.com/azure/service-fabric/concepts-managed-identity)

關於如何使用受控識別進行驗證，請參閱[範例](https://github.com/Azure/azure-sdk-for-js/blob/hotfix/identity_1.3.0/sdk/identity/identity/samples/AzureIdentityExamples.md#authenticating-in-azure-with-managed-identity)

## <a name="credential-classes"></a>認證類別

### <a name="authenticating-azure-hosted-applications"></a>驗證 Azure 託管應用程式

| 認證 (credential)                  | usage                                                                                                            | 範例                                                                                                                                                                                                |
| --------------------------- | ---------------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| `DefaultAzureCredential`    | 提供簡化的驗證體驗，讓您得以快速開始在 Azure 雲端中開發應用程式。 | [範例](https://github.com/Azure/azure-sdk-for-js/blob/hotfix/identity_1.3.0/sdk/identity/identity/samples/AzureIdentityExamples.md#authenticating-with-defaultazurecredential)                      |
| `ChainedTokenCredential`    | 允許使用者定義撰寫多個認證的自訂驗證流程。                               | [範例](https://github.com/Azure/azure-sdk-for-js/blob/hotfix/identity_1.3.0/sdk/identity/identity/samples/AzureIdentityExamples.md#chaining-credentials)                                            |
| `EnvironmentCredential`     | 透過環境變數中指定的認證資訊來驗證服務主體或使用者。         | [範例](https://github.com/Azure/azure-sdk-for-js/blob/hotfix/identity_1.3.0/sdk/identity/identity/samples/AzureIdentityExamples.md#authenticating-a-service-principal-with-environment-credentials) |
| `ManagedIdentityCredential` | 驗證 Azure 資源的受控識別。                                                         | [範例](https://github.com/Azure/azure-sdk-for-js/blob/hotfix/identity_1.3.0/sdk/identity/identity/samples/AzureIdentityExamples.md#authenticating-in-azure-with-managed-identity)                   |

### <a name="authenticating-service-principals"></a>驗證服務主體

| 認證 (credential)                    | usage                                                  | 範例                                                                                                                                                                                             | reference                                                                                                                        |
| ----------------------------- | ------------------------------------------------------ | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | -------------------------------------------------------------------------------------------------------------------------------- |
| `ClientSecretCredential`      | 使用密碼驗證服務主體。      | [範例](https://github.com/Azure/azure-sdk-for-js/blob/hotfix/identity_1.3.0/sdk/identity/identity/samples/AzureIdentityExamples.md#authenticating-a-service-principal-with-a-client-secret)      | [服務主體驗證](https://docs.microsoft.com/azure/active-directory/develop/app-objects-and-service-principals) |
| `ClientCertificateCredential` | 使用憑證驗證服務主體。 | [範例](https://github.com/Azure/azure-sdk-for-js/blob/hotfix/identity_1.3.0/sdk/identity/identity/samples/AzureIdentityExamples.md#authenticating-a-service-principal-with-a-client-certificate) | [服務主體驗證](https://docs.microsoft.com/azure/active-directory/develop/app-objects-and-service-principals) |

### <a name="authenticating-users"></a>驗證使用者

| 認證 (credential)                     | usage                                                                                                                                                                                                                       | 範例                                                                                                                                                                                           | reference                                                                                                        |
| ------------------------------ | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ---------------------------------------------------------------------------------------------------------------- |
| `InteractiveBrowserCredential` | 透過預設系統瀏覽器以互動方式驗證使用者。 請按一下[此處](https://github.com/Azure/azure-sdk-for-js/blob/master/sdk/identity/identity/interactive-browser-credential.md)以深入瞭解做法。 | [範例](https://github.com/Azure/azure-sdk-for-js/blob/hotfix/identity_1.3.0/sdk/identity/identity/samples/AzureIdentityExamples.md#authenticating-a-user-account-interactively-in-the-browser) | [OAuth2 驗證碼](https://docs.microsoft.com/azure/active-directory/develop/v2-oauth2-auth-code-flow) |
| `DeviceCodeCredential`         | 在 UI 受限的裝置上以互動方式驗證使用者。                                                                                                                                                              | [範例](https://github.com/Azure/azure-sdk-for-js/blob/hotfix/identity_1.3.0/sdk/identity/identity/samples/AzureIdentityExamples.md#authenticating-a-user-account-with-device-code-flow)        | [裝置程式碼驗證](https://docs.microsoft.com/azure/active-directory/develop/v2-oauth2-device-code)    |
| `UserPasswordCredential`       | 以使用者名稱和密碼來驗證使用者。                                                                                                                                                                          | [範例](https://github.com/Azure/azure-sdk-for-js/blob/hotfix/identity_1.3.0/sdk/identity/identity/samples/AzureIdentityExamples.md#authenticating-a-user-account-with-username-and-password)   | [使用者名稱 + 密碼驗證](https://docs.microsoft.com/azure/active-directory/develop/v2-oauth-ropc)    |
| `AuthorizationCodeCredential`  | 使用先前取得的授權碼來驗證使用者。                                                                                                                                                          | [範例](https://github.com/Azure/azure-sdk-for-js/blob/hotfix/identity_1.3.0/sdk/identity/identity/samples/AzureIdentityExamples.md#authenticating-a-user-account-with-auth-code-flow)          | [OAuth2 驗證碼](https://docs.microsoft.com/azure/active-directory/develop/v2-oauth2-auth-code-flow) |

### <a name="authenticating-via-development-tools"></a>透過開發工具進行驗證

| 認證 (credential)                   | usage                                                              | 範例                                                                                                                                                                                      | reference                                                                               |
| ---------------------------- | ------------------------------------------------------------------ | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | --------------------------------------------------------------------------------------- |
| `AzureCliCredential`         | 使用 Azure CLI 在開發環境中進行驗證。      | [範例](https://github.com/Azure/azure-sdk-for-js/blob/hotfix/identity_1.3.0/sdk/identity/identity/samples/AzureIdentityExamples.md#authenticating-a-user-account-with-azure-cli)          | [Azure CLI 驗證](https://docs.microsoft.com/cli/azure/authenticate-azure-cli) |
| `VisualStudioCodeCredential` | 使用 Visual Studio Code 在開發環境中進行驗證。 | [範例](https://github.com/Azure/azure-sdk-for-js/blob/hotfix/identity_1.3.0/sdk/identity/identity/samples/AzureIdentityExamples.md#authenticating-a-user-account-with-visual-studio-code) | [VS Code Azure 延伸模組](https://code.visualstudio.com/docs/azure/extensions)          |

## <a name="troubleshooting"></a>疑難排解

### <a name="error-handling"></a>錯誤處理

認證無法驗證時會引發 `AuthenticationError`。 此類別有一個 `message` 欄位，描述驗證失敗的原因。 `AggregateAuthenticationError` 將會由 `ChainedTokenCredential` 引發，其中 `errors` 欄位包含來自鏈結中每個認證的錯誤陣列。

### <a name="logging"></a>記錄

啟用記錄有助於找出失敗的相關實用資訊。 若要查看 HTTP 的要求和回應記錄，請將 `AZURE_LOG_LEVEL` 環境變數設定為 `info`。 或者，您可以在 `@azure/logger` 中呼叫 `setLogLevel`，以在執行階段啟用記錄：

```javascript
import { setLogLevel } from "@azure/logger";

setLogLevel("info");
```

## <a name="next-steps"></a>後續步驟

### <a name="read-the-documentation"></a>閱讀文件

您可在我們的[文件網站](https://docs.microsoft.com/javascript/api/@azure/identity)中查找此程式庫的 API 文件。

### <a name="provide-feedback"></a>提供意見反應

如果您遇到錯誤或有任何建議，請[提出問題](https://github.com/Azure/azure-sdk-for-js/issues)。

## <a name="contributing"></a>參與

如果您希望向此程式庫投稿，請參閱[投稿指南](https://github.com/Azure/azure-sdk-for-js/blob/master/CONTRIBUTING.md)，深入瞭解如何組建與測試程式碼。

[1]: https://azuresdkdocs.blob.core.windows.net/$web/javascript/azure-identity/1.0.0/classes/defaultazurecredential.html
[2]: https://azuresdkdocs.blob.core.windows.net/$web/javascript/azure-identity/1.0.0/classes/managedidentitycredential.html
[3]: https://azuresdkdocs.blob.core.windows.net/$web/javascript/azure-identity/1.0.0/classes/environmentcredential.html
[4]: https://azuresdkdocs.blob.core.windows.net/$web/javascript/azure-identity/1.0.0/classes/clientsecretcredential.html
[5]: https://azuresdkdocs.blob.core.windows.net/$web/javascript/azure-identity/1.0.0/classes/clientcertificatecredential.html
[6]: https://azuresdkdocs.blob.core.windows.net/$web/javascript/azure-identity/1.0.0/classes/devicecodecredential.html
[7]: https://azuresdkdocs.blob.core.windows.net/$web/javascript/azure-identity/1.0.0/classes/authorizationcodecredential.html
[8]: https://azuresdkdocs.blob.core.windows.net/$web/javascript/azure-identity/1.0.0/classes/interactivebrowsercredential.html
[9]: https://azuresdkdocs.blob.core.windows.net/$web/javascript/azure-identity/1.0.0/classes/usernamepasswordcredential.html
[azure_cli]: https://docs.microsoft.com/cli/azure
[vscodelogincommand_image]: https://raw.githubusercontent.com/Azure/azure-sdk-for-js/master/sdk/identity/identity/images/VsCodeLoginCommand.png
[azureclilogin_image]: https://raw.githubusercontent.com/Azure/azure-sdk-for-js/master/sdk/identity/identity/images/AzureCliLogin.png
[azureclilogindevicecode_image]: https://raw.githubusercontent.com/Azure/azure-sdk-for-js/master/sdk/identity/identity/images/AzureCliLoginDeviceCode.png
[defaultauthflow_image]: https://raw.githubusercontent.com/Azure/azure-sdk-for-js/master/sdk/identity/identity/images/DefaultAzureCredentialAuthenticationFlow.png

![曝光數](https://azure-sdk-impressions.azurewebsites.net/api/impressions/azure-sdk-for-js%2Fsdk%2Fidentity%2Fidentity%2FREADME.png)
