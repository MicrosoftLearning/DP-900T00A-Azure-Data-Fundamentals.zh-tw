---
ms.openlocfilehash: 81fd1455668c9343defe69cbbbff10d48b1f97ef
ms.sourcegitcommit: e739004291428ce83f14b9d49f1e9dfaa3762dde
ms.translationtype: HT
ms.contentlocale: zh-TW
ms.lasthandoff: 02/05/2022
ms.locfileid: "138050916"
---
<a name="gauge"></a>gauge
=====

幾近無狀態的終端水平量測計/進度列。

```javascript
var Gauge = require("gauge")

var gauge = new Gauge()

gauge.show("test", 0.20)

gauge.pulse("this")

gauge.hide()
```

![](gauge-demo.gif)


### <a name="changes-from-1x"></a>自 1.x 版的變更

Gauge 2.x 版為中斷性發行版本。若您先前便是本模組的使用者，請參閱[變更記錄]，了解詳細變更資訊。

[變更記錄]: CHANGELOG.md

### <a name="the-gauge-class"></a>量測計類別

這是本模組的典型介面，亦即透過「射後不理」(fire-and-forget) 介面顯示您的狀態資訊。

```
var Gauge = require("gauge")

var gauge = new Gauge([stream], [options])
```

* **stream**： *(選用，預設為 STDERR)* 要寫入進度列更新的資料流。  如有指示，量測計會執行背壓並暫停大多數寫入作業。
* **options**：(選用) 選項物件。

建構新量測計。 量測計會繪製在單一行上。假如 **stream** 並非 tty，且未明確提供任何 tty，則不會繪製。

若 **stream** 為終端，或者您將 **tty** 傳入 **options**，本模組便會偵測終端調整大小，並據此再次繪製以符合需求。  本模組藉由監看 tty 上的 `resize` 事件來執行這項作業。  (為了解決 Node 2.5.0 版之前的版本錯誤，在 tty 為 stderr 的情況下，本模組會在 stdout 上監看這些舊版本。)將視窗調大沒有問題，不過縮小視窗往往會留下冗贅元素。

**重要事項：** 如果您先前傳入的不是 tty 資料流，但您仍想取得輸出 (例如包裝在 `ansi` 模組中的資料流)，那麼您必須傳入下方的 **tty** 選項，因為 `gauge` 須存取基礎 tty 才能執行重新調整終端大小及偵測終端寬度等動作。

**options** 物件可能具有下列屬性，所有屬性均為選用：

* **updateInterval**：量測計更新的繪製頻率 (以毫秒為單位)。
* **fixedFramerate**：在節點 0.8 上預設為 false，其他則全部預設為 true。  這個屬性設為 true 時，會建立一個每 `updateInterval` 毫秒觸發一次的計時器；如設為 false，則每次更新都會立即列印，但發生頻率高於 `updateInterval` 的更新則會受到忽略。  0\.8 不設定為 true 的理由是因為無法 `unref` 其計時器，這會導致您的程式無法結束。如果您想搭配 0.8 使用這項功能，請務必在預計程式結束之前呼叫 `gauge.disable()`。
* **themes**：選擇要使用的主題時所用的主題集， 預設為 `gauge/themes`。如需詳細資訊，請參閱 [themes] 文件。
* **theme**:選擇要使用的主題。主題可以是：
  * 主題物件：如使用此物件，便不會用到 **themes**。
  * 主題名稱：會在目前的 *themes* 物件中查詢。
  * 含有 `hasUnicode`、`hasColor` 或 `platform` 任一索引鍵的設定物件：選取預設主題時會覆寫猜測。

  如未選取任何主題，則會根據本模組對您的作業系統、色彩支援與 unicode 支援的最佳猜測組合挑選預設主題。
* **template**:描述您期望的量測計外觀，  預設為 npm 使用的值。  本文稍後會提供更詳細的[文件]。
* **hideCursor**：預設為 true。  當這個值為 true，顯示量測計時會隱藏游標。
* **tty**：您最終會寫入的 tty，  預設值與 **stream** 相同。  這個屬性用於偵測終端的寬度及調整大小， 使用的寬度為 `tty.columns - 1`。 若沒有可用的 tty，則假設寬度為 `79`。
* **enabled**：如 `tty` 為 TTY 則預設為 true，其他情況則預設為 false。  當這個值為 true，量測計會啟用。  如果量測計停用，則忽略所有更新指令，要等到您呼叫 `.enable()` 之後，才會開始列印量測計。
* **Plumbing**：實際產生要列印的量測計時所使用的類別。  這個屬性預設為 `require('gauge/plumbing')`，一般而言不必覆寫。
* **cleanupOnExit**：預設為 true。 一般而言，我們會登錄結束處理常式，以確保您的流程結束後游標會重新啟用，進度列也會清除，即使您用 Ctrl-C 退出或流程因其他理由無預警結束，亦然。 如停用這個屬性，便不會登錄結束處理常式。

[has-unicode]: https://www.npmjs.com/package/has-unicode
[themes]: #themes
[文件]: #templates

#### `gauge.show(section | status, [completed])`

第一個引數可為區段、目前提供進度的物品，或是含有 **section**、**subsection** & **completed** 等索引鍵 (或您在自訂範本中已定義類型的任何其他索引鍵) 的物件。  如果您不想更新或設定任何值，只要傳遞 `null` 就可以加以忽略。

第二個引數為已完成的百分比，為介於 0 至 1 之間的值。
如果沒有這個引數，完成狀態就不會更新。 完成狀態也可以作為狀態物件的一部份，傳入為第一個引數。 若同時傳入完成狀態和 completed 引數，則優先採用 completed 引數。

#### `gauge.hide([cb])`

將量測計從終端移除。  您可以在 IO 有機會發生後 (目前這是指在 `setImmediate` 回呼後)，自行選擇是否要回呼 `cb`。

當您暫停一個檔案控制代碼的進度列並列印至另一個檔案控制代碼時，這個動作就非常重要。若未執行此動作 (擁有夠大的列印)，節點最後可能會將「結束進度列」位元列印至進度列檔案控制代碼，同時將其他物品列印至另一個檔案控制代碼。 這些交錯執行動作可能會在部分終端造成損毀。

#### `gauge.pulse([subsection])`

* **subsection**：(選用) 觸發脈衝的特定物品

微調量測計中的微調按鈕以顯示輸出。  如納入 **subsection**，則會與最後一個傳遞至 `gauge.show` 的名稱合併。

#### `gauge.disable()`

隱藏量測計並忽略之後對 `show` 或 `pulse` 的呼叫。

#### `gauge.enable()`

顯示量測計並在呼叫 `show` 或 `pulse` 時繼續更新。

#### `gauge.isEnabled()`

如量測計已啟用，則傳回 true。

#### `gauge.setThemeset(themes)`

變更要從中選取主題的主題集。 與建構函式中使用的 `themes` 選項相同。 系統會從這個主題集中重新選取主題。

#### `gauge.setTheme(theme)`

變更使用中的主題，新主題會在下次出現或在下個脈衝顯示。 這可以是：

* 主題物件：如使用此物件，便不會用到 **themes**。
* 主題名稱：會在目前的 *themes* 物件中查詢。
* 含有 `hasUnicode`、`hasColor` 或 `platform` 任一索引鍵的設定物件：選取預設主題時會覆寫猜測。

如未選取任何主題，則會根據本模組對您的作業系統、色彩支援與 unicode 支援的最佳猜測組合挑選預設主題。

#### `gauge.setTemplate(template)`

變更使用中的範本，新範本會在下次出現或在下個脈衝顯示

### <a name="tracking-completion"></a>追蹤完成狀態

如果您想追蹤多個物品的完成狀態，相關的 [are-we-there-yet] (英文) 可以派上用場。  這是 `change` 事件，可以連接至 `show` 方法，藉此取得較傳統的進度列介面。

[are-we-there-yet]: https://www.npmjs.com/package/are-we-there-yet

### <a name="themes"></a>THEMES

```
var themes = require('gauge/themes')

// fetch the default color unicode theme for this platform
var ourTheme = themes({hasUnicode: true, hasColor: true})

// fetch the default non-color unicode theme for osx
var ourTheme = themes({hasUnicode: true, hasColor: false, platform: 'darwin'})

// create a new theme based on the color ascii theme for this platform
// that brackets the progress bar with arrows
var ourTheme = themes.newTheme(theme(hasUnicode: false, hasColor: true}), {
  preProgressbar: '→',
  postProgressbar: '←'
})
```

`gauge/themes` 傳回的物件是 `ThemeSet` 類別的執行個體。

```
var ThemeSet = require('gauge/theme-set')
var themes = new ThemeSet()
// or
var themes = require('gauge/themes')
var mythemes = themes.newThemeset() // creates a new themeset based on the default themes
```

#### <a name="themesopts"></a>themes(opts)
#### <a name="themesgetdefaultopts"></a>themes.getDefault(opts)

主題物件是會根據平台、unicode、色彩支援擷取預設主題的函式。

選項是具備下列屬性的物件：

* **hasUnicode**：這個值為 true 時會擷取 unicode 主題；如果沒有可用的 unicode 主題，才會使用非 unicode 主題。
* **hasColor**：這個值為 true 時會擷取色彩主題；如果沒有可用的色彩主題，才會使用非色彩主題。
* **platform** (選用)：預設為 `process.platform`。  若找不到符合的平台，會改用 `fallback`。

若找不到相容的主題，則會擲回錯誤和 `EMISSINGTHEME` 的 `code`。

#### <a name="themesaddthemethemename-themeobj"></a>themes.addTheme(themeName, themeObj)
#### <a name="themesaddthemethemename-parenttheme-newtheme"></a>themes.addTheme(themeName, [parentTheme], newTheme)

在主題集中新增一個已命名主題。  您可以傳入主題物件 (如 `themes.newTheme` 傳回的物件)，或您會傳遞給 `themes.newTheme` 的引數。

#### <a name="themesgetthemenames"></a>themes.getThemeNames()

傳回一份清單，其中列出此主題集中所有主題的名稱。 適合用於 `themes.getTheme(…)`。

#### <a name="themesgetthemename"></a>themes.getTheme(name)

從名為 `name` 的主題集中傳回主題物件。

若此主題集中沒有 `name`，則會擲回錯誤和 `EMISSINGTHEME` 的 `code`。

#### <a name="themessetdefaultopts-themename"></a>themes.setDefault([opts], themeName)

`opts` 是具有下列屬性的物件。

* **platform**：預設為 `'fallback'`。  如果您的主題為平台專屬主題，請在這裡指定 `process.platform` 中的平台，例如 `win32`、`darwin` 等。
* **hasUnicode**：預設為 `false`。 若您的主題使用 unicode，您就必須將這個屬性設為 true。
* **hasColor**：預設為 `false`。  若您的主題使用色彩，您就必須將這個屬性設為 true。

`themeName` 是要在這組 `opts` 中使用的主題名稱 (如同提供給 `addTheme` 的名稱)。

#### <a name="themesnewthemeparenttheme-newtheme"></a>themes.newTheme([parentTheme,] newTheme)

根據 `parentTheme` 建立新的主題物件。  如未提供 `parentTheme`，則會定義用途為定義轉譯活動指標 (微調按鈕) 和進度列時，所使用函式的最小 parentTheme。 (`gauge/base-theme` 中定義了此後援父主題。)

newTheme 必須為裸物件。首先來介紹預設主題定義的屬性：

* **preProgressbar**：顯示進度列時，會在進度列之前顯示。
* **postProgressbar**：顯示進度列時，會在進度列之後顯示。
* **progressBarTheme**：傳遞至進度列轉譯器的子主題。這是含有 `complete` 與 `remaining` 屬性的物件，這些屬性則是您會希望在進度列區段中重複的字串。
* **activityIndicatorTheme**：活動指標 (微調按鈕) 的主題，可以是字串 (每個字元代表不同步驟) 或字串陣列。
* **preSubsection**：顯示在 `section` 與 `subsection` 之間的分隔符號，只會在後者列印出來時顯示。

一般而言，只要是在轉譯範本時有效的值，都可以當作主題的值。 當主題中的屬性名稱符合範本中的類型，就會使用這些屬性。 這些屬性的值可以是：

* **字串及數字**：會維持不變
* **函式 (values、theme、width)** ：會傳回您希望輸出包含的內容。
  *「values」* 是含有透過 `gauge.show` 所提供值的物件， *「theme」* 是此項目專屬的主題 (請參閱下文) 或此主題物件， *「width」* 則是結果應呈現的字元數寬度。

以下列出幾個特別的前置詞：

* **pre**：顯示屬性時，會在屬性之前顯示。
* **post**：顯示屬性時，會在屬性之後顯示。

還有一個特別的後置詞：

* **Theme**：其值會傳遞至 function-type 項目當作主題。

#### <a name="themesaddtoallthemestheme"></a>themes.addToAllThemes(theme)

將 *「混入」* `theme`目前定義的所有主題， 也將其新增至此主題集的預設父主題，讓日後新增至此主題集的所有主題都預設採用 `theme` 的值。

#### <a name="themesnewthemeset"></a>themes.newThemeset()

將目前的主題集複製到新的主題集，  方便您讓一個主題集繼承另一個主題集的內容。

### <a name="templates"></a>範本

範本是物件和字串組成的陣列，經過評估後會轉換成量測計的行。  預設的範本為：

```javascript
[
    {type: 'progressbar', length: 20},
    {type: 'activityIndicator', kerning: 1, length: 1},
    {type: 'section', kerning: 1, default: ''},
    {type: 'subsection', kerning: 1, default: ''}
]
```

各式範本元素可以是 **純文字字串** (會一字不差地納入輸出中)，也可以是包含下列屬性的物件：

* *「type」* 可為下列任何一項，加上您傳入 `gauge.show` 的任何索引鍵以及自訂主題中含有的任何索引鍵。
  * `section`：您目前正在處理的大型物品。
  * `subsection`：該物品目前正在運作的元件。
  * `activityIndicator`：顯示從您的使用中主題裡採用 `activityIndicatorTheme` 的微調按鈕。
  * `progressbar`：利用您使用中主題的 `progressbarTheme` 表示目前 `completed` 的進度列。
* *kerning*：顯示項目時，兩個項目之間必須相隔的空格數。
* *maxLength*：此元素的最大長度。 假如值的長度超過最大長度，便會遭到截斷。
* *minLength*：此元素的最小長度。 假如值的長度未達最小長度，便會根據 *align* 值加以填補。
* *align*：(預設值：left) 可能的值包含「left」、「right」、「center」。 運作方式與文字處理器相同。
* *length*：為 *minLength* 與 *maxLength* 提供單一值。 若同時指定 *length* 與 *minLength* 或 *maxLength*，則以後者為優先。
* *value*：用於此範本項目的常值。
* *default*：如未以其他方式傳入值，則在此範本項目中使用的預設值。

### <a name="plumbing"></a>PLUMBING

這是超級簡單、不做任何假設，也沒有任何神奇之處的內部元素，供量測器用於實作其一般介面。

```
var Plumbing = require('gauge/plumbing')
var gauge = new Plumbing(theme, template, width)
```

* **theme**:要使用的主題。
* **template**:要使用的範本。
* **width**：量測計應有的寬度

#### `gauge.setTheme(theme)`

變更使用中的主題。

#### `gauge.setTemplate(template)`

變更使用中的範本。

#### `gauge.setWidth(width)`

變更要顯示的寬度。

#### `gauge.hide()`

傳回隱藏進度列所需的字串

#### `gauge.hideCursor()`

傳回用於隱藏游標的字串。

#### `gauge.showCursor()`

傳回用於顯示游標的字串。

#### `gauge.show(status)`

使用 `status` 作為值，以主題轉譯提供的範本，並傳回適合列印的字串以更新量測計。
