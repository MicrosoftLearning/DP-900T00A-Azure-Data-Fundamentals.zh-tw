---
ms.openlocfilehash: 496981207a34eb019688e8f2583ccc1abcbb5bce
ms.sourcegitcommit: e739004291428ce83f14b9d49f1e9dfaa3762dde
ms.translationtype: HT
ms.contentlocale: zh-TW
ms.lasthandoff: 02/05/2022
ms.locfileid: "138050436"
---
<a name="semver1----the-semantic-versioner-for-npm"></a>SemVer(1)—npm 的語意版本器
===========================================

## <a name="install"></a>安裝

```bash
npm install --save semver
````

## <a name="usage"></a>使用方式

作為節點模組：

```js
const semver = require('semver')

semver.valid('1.2.3') // '1.2.3'
semver.valid('a.b.c') // null
semver.clean('  =v1.2.3   ') // '1.2.3'
semver.satisfies('1.2.3', '1.x || >=2.5.0 || 5.0.0 - 7.2.3') // true
semver.gt('1.2.3', '9.8.7') // false
semver.lt('1.2.3', '9.8.7') // true
semver.minVersion('>=1.0.0') // '1.0.0'
semver.valid(semver.coerce('v2')) // '2.0.0'
semver.valid(semver.coerce('42.6.7.9.3-alpha')) // '42.6.7'
```

作為命令列公用程式：

```
$ semver -h

A JavaScript implementation of the https://semver.org/ specification
Copyright Isaac Z. Schlueter

Usage: semver [options] <version> [<version> [...]]
Prints valid versions sorted by SemVer precedence

Options:
-r --range <range>
        Print versions that match the specified range.

-i --increment [<level>]
        Increment a version by the specified level.  Level can
        be one of: major, minor, patch, premajor, preminor,
        prepatch, or prerelease.  Default level is 'patch'.
        Only one version may be specified.

--preid <identifier>
        Identifier to be used to prefix premajor, preminor,
        prepatch or prerelease version increments.

-l --loose
        Interpret versions and ranges loosely

-p --include-prerelease
        Always include prerelease versions in range matching

-c --coerce
        Coerce a string into SemVer if possible
        (does not imply --loose)

Program exits successfully if any valid version satisfies
all supplied ranges, and prints all satisfying versions.

If no satisfying versions are found, then exits failure.

Versions are printed in ascending order, so supplying
multiple versions to the utility will just sort them.
```

## <a name="versions"></a>版本

在 <https://semver.org/> 中找到 `v2.0.0` 規格所描述的「版本」。

前置 `"="` 或 `"v"` 字元會去除並忽略。

## <a name="ranges"></a>範圍

`version range` 是一組 `comparators`，能指定滿足範圍的版本。

`comparator` 是由 `operator` 和 `version` 所組成。  基本 `operators` 的集合為：

* `<` 小於
* `<=` 小於或等於
* `>` 大於
* `>=` 大於或等於
* `=` 等於。  如果未指定任何運算子，則會假設相等，因此此運算子是選擇性的，但可能會包含其中。

例如，比較子 `>=1.2.7` 會與 `1.2.7`、`1.2.8`、`2.5.3` 和 `1.3.9` 版本相符，但與 `1.2.6` 或 `1.1.0` 版本不相符。

比較子可以由空白字元聯結，形成 `comparator set`，符合其包含所有比較子的 **與** 交集。

範圍是由一或多個比較子集合所組成，由 `||` 聯結。  只有在版本至少符合其中一個 `||` 的分隔比較子集合中的每個比較子時，版本才會符合範圍。

例如，範圍 `>=1.2.7 <1.3.0` 會與 `1.2.7`、`1.2.8` 和 `1.2.99` 版本相符，但與 `1.2.6`、`1.3.0` 或 `1.1.0` 版本不相符。

範圍 `1.2.7 || >=1.2.9 <2.0.0` 會與 `1.2.7`、`1.2.9` 和 `1.4.6` 版本相符，但與 `1.2.8` 或 `2.0.0` 版本不相符。

### <a name="prerelease-tags"></a>發行前版本標籤

如果版本具有發行前版本標籤 (例如 `1.2.3-alpha.3`)，則只有在至少一個比較子具有相同 `[major, minor, patch]` Tuple 也具有發行前版本標籤時，才允許符合比較子集合。

例如，允許範圍 `>1.2.3-alpha.3` 符合版本 `1.2.3-alpha.7`，但即使根據 SemVer 排序規則，就技術上來說 `3.4.5-alpha.9`「大於」`1.2.3-alpha.3`，`3.4.5-alpha.9` 仍 *無法* 符合此範圍。  版本範圍只接受版本 `1.2.3` 的發行前版本標籤。  由於版本 `3.4.5` 沒有發行前版本旗標且 `3.4.5` 大於 `1.2.3-alpha.7`，因此 *會* 滿足範圍。

此行為的目的有兩個。  首先，發行前版本經常會非常快速地更新，並包含 (依作者的設計) 尚不適合公眾使用的許多中斷性變更。
因此，依預設它們會從範圍相符語意中排除。

其次，選擇使用發行前版本的使用者已清楚指出使用 *該特定* Alpha/Beta/RC 版本集的意圖。  使用者在範圍中包含發行前版本標籤，即表示他們知道風險。  不過，仍然不宜假設他們已選擇在 *下一* 組發行前版本上承擔類似風險。

請注意，您可以將選項物件上的 `includePrerelease` 旗標設定為任何執行範圍比對的[函式](https://github.com/npm/node-semver#functions)，藉此隱藏此行為 (基於範圍比對之目的，將所有發行前版本視為一般版本)。

#### <a name="prerelease-identifiers"></a>發行前版本識別碼

方法 `.inc` 會採用額外的 `identifier` 字串引數，將字串值附加為發行前版本識別碼：

```javascript
semver.inc('1.2.3', 'prerelease', 'beta')
// '1.2.4-beta.0'
```

命令列範例：

```bash
$ semver 1.2.3 -i prerelease --preid beta
1.2.4-beta.0
```

可接著用於進一步遞增：

```bash
$ semver 1.2.4-beta.0 -i prerelease
1.2.4-beta.1
```

### <a name="advanced-range-syntax"></a>進階範圍語法

進階範圍語法會以確定性方式對基本比較子解語法糖。

進階範圍可以與使用空白字元或 `||` 的基本比較子相同方式合併。

#### <a name="hyphen-ranges-xyz---abc"></a>連字號範圍 `X.Y.Z - A.B.C`

指定內含集合。

* `1.2.3 - 2.3.4` := `>=1.2.3 <=2.3.4`

如果部分版本由內含範圍中的第一個版本提供，則遺失的項目會以零取代。

* `1.2 - 2.3.4` := `>=1.2.0 <=2.3.4`

如果部分版本由內含範圍中以第二個版本的形式提供，則會接受從 Tuple 供應組件開始的所有版本，但大於提供的 Tuple 組件則不會接受。

* `1.2.3 - 2.3` := `>=1.2.3 <2.4.0`
* `1.2.3 - 2` := `>=1.2.3 <3.0.0`

#### <a name="x-ranges-12x-1x-12-"></a>X-Range `1.2.x` `1.X` `1.2.*` `*`

任一 `X`、`x` 或 `*` 都可以用於「代替」 `[major, minor, patch]` Tuple 中其中一個數值。

* `*` ：= `>=0.0.0` (任何版本都符合)
* `1.x` ：= `>=1.0.0 <2.0.0` (符合主要版本)
* `1.2.x` := `>=1.2.0 <1.3.0` (符合主要和次要版本)

部分版本範圍會被視為 X-Range，因此實際上特殊字元是選用的項目。

* `""` (空白字串) := `*` := `>=0.0.0`
* `1` := `1.x.x` := `>=1.0.0 <2.0.0`
* `1.2` := `1.2.x` := `>=1.2.0 <1.3.0`

#### <a name="tilde-ranges-123-12-1"></a>波狀符號範圍 `~1.2.3``~1.2``~1`

若比較子上已指定次要版本，則允許修補檔等級的變更。  若不是，則允許次要等級的變更。

* `~1.2.3` := `>=1.2.3 <1.(2+1).0` := `>=1.2.3 <1.3.0`
* `~1.2` := `>=1.2.0 <1.(2+1).0` := `>=1.2.0 <1.3.0` (與 `1.2.x` 相同)
* `~1` := `>=1.0.0 <(1+1).0.0` := `>=1.0.0 <2.0.0` (與 `1.x` 相同)
* `~0.2.3` := `>=0.2.3 <0.(2+1).0` := `>=0.2.3 <0.3.0`
* `~0.2` := `>=0.2.0 <0.(2+1).0` := `>=0.2.0 <0.3.0` (與 `0.2.x` 相同)
* `~0` := `>=0.0.0 <(0+1).0.0` := `>=0.0.0 <1.0.0` (與 `0.x` 相同)
* `~1.2.3-beta.2`：= `>=1.2.3-beta.2 <1.3.0` 請注意，如果版本大於或等於 `beta.2`，則會允許在 `1.2.3` 版本中預先發行。  因此，允許 `1.2.3-beta.4`，但不允許 `1.2.4-beta.2`，因為它是不同 `[major, minor, patch]` Tuple 的發行前版本。

#### <a name="caret-ranges-123-025-004"></a>插入點範圍 `^1.2.3``^0.2.5``^0.0.4`

允許不會修改 `[major, minor, patch]` Tuple 中最左邊非零位數的變更。  換句話說，這代表允許版本 `1.0.0` 與更新版本的修補檔和次要更新、版本 `0.X >=0.1.0` 的修補檔更新以及版本 `0.0.X` 的 *無* 更新。

許多作者會將 `0.x` 版本視為 `x` 是主要「中斷性變更」指標。

當作者可能會在`0.2.4` 和 `0.3.0` 版本之間進行中斷性變更時 (這是常見的作法)，則插入點範圍很理想。
不過，前提是 `0.2.4` 和 `0.2.5` 之間 *不會* 有中斷性變更。  根據常見做法，其允許假設為加法類 (但不中斷) 的變更。

* `^1.2.3` := `>=1.2.3 <2.0.0`
* `^0.2.3` := `>=0.2.3 <0.3.0`
* `^0.0.3` := `>=0.0.3 <0.0.4`
* `^1.2.3-beta.2`：= `>=1.2.3-beta.2 <2.0.0` 請注意，如果版本大於或等於 `beta.2`，則會允許在 `1.2.3` 版本中預先發行。  因此，允許 `1.2.3-beta.4`，但不允許 `1.2.4-beta.2`，因為它是不同 `[major, minor, patch]` Tuple 的發行前版本。
* `^0.0.3-beta`：= `>=0.0.3-beta <0.0.4` 請注意，如果版本大於或等於 `beta`，則 *只* 允許在 `0.0.3` 版本中預先發行。  因此允許 `0.0.3-pr.2`。

剖析插入號範圍時，遺失的 `patch` 值會對數字 `0` 解語法糖，但允許該值內的彈性，即使主要和次要版本都是 `0`。

* `^1.2.x` := `>=1.2.0 <2.0.0`
* `^0.0.x` := `>=0.0.0 <0.1.0`
* `^0.0` := `>=0.0.0 <0.1.0`

遺失的 `minor` 和 `patch` 值會解語法糖為零，但也允許這些值內的彈性，即使主要版本是零。

* `^1.x` := `>=1.0.0 <2.0.0`
* `^0.x` := `>=0.0.0 <1.0.0`

### <a name="range-grammar"></a>範圍文法

總結以上，以下是範圍的巴克斯文法，供剖析器作者使用：

```bnf
range-set  ::= range ( logical-or range ) *
logical-or ::= ( ' ' ) * '||' ( ' ' ) *
range      ::= hyphen | simple ( ' ' simple ) * | ''
hyphen     ::= partial ' - ' partial
simple     ::= primitive | partial | tilde | caret
primitive  ::= ( '<' | '>' | '>=' | '<=' | '=' ) partial
partial    ::= xr ( '.' xr ( '.' xr qualifier ? )? )?
xr         ::= 'x' | 'X' | '*' | nr
nr         ::= '0' | ['1'-'9'] ( ['0'-'9'] ) *
tilde      ::= '~' partial
caret      ::= '^' partial
qualifier  ::= ( '-' pre )? ( '+' build )?
pre        ::= parts
build      ::= parts
parts      ::= part ( '.' part ) *
part       ::= nr | [-0-9A-Za-z]+
```

## <a name="functions"></a>函式

所有方法和類別都會採用最終 `options` 物件引數。  此物件中的所有選項皆預設為 `false`。  支援的選項如下：

- `loose` 對非完全有效的 SemVer 字串更加寬容。
  (任何結果輸出當然會一律是 100% 嚴格符合。)基於回溯相容性，若 `options` 引數為布林值而非物件，則會解譯為 `loose` 參數。
- 除非明確選擇加入，`includePrerelease` 設定為從範圍中隱藏排除發行前已標記版本的 [預設行為](https://github.com/npm/node-semver#prerelease-tags)。

嚴格模式比較子和範圍會對剖析的 SemVer 字串十分嚴格。

* `valid(v)`：傳回已剖析的版本，如果無效則傳回 null。
* `inc(v, release)`：傳回以發行類型遞增的版本 (`major`、   `premajor`、`minor`、`preminor`、`patch`、`prepatch` 或 `prerelease`)，如果版本無效則傳回 null
  * `premajor` 在一次呼叫中，會將版本改為下一個主要版本，並向下移至該主要版本的發行前版本。
    `preminor` 和 `prepatch` 的運作方式相同。
  * 如果從非發行前版本呼叫，則 `prerelease` 的運作方式會與 `prepatch` 相同。 它會遞增修補檔版本，然後建立發行前版本。 如果輸入版本已經是發行前版本，則只會進行遞增。
* `prerelease(v)`：傳回發行前版本元件的陣列，如果沒有陣列則傳回 null。 範例： `prerelease('1.2.3-alpha.1') -> ['alpha', 1]`
* `major(v)`：傳回主要版本號碼。
* `minor(v)`：傳回次要版本號碼。
* `patch(v)`：傳回修補檔版本號碼。
* `intersects(r1, r2, loose)`：如果兩個提供的範圍或比較子交集，則傳回 true。
* `parse(v)`：嘗試將字串剖析為語意版本，並傳回 `SemVer` 物件或 `null`。

### <a name="comparison"></a>比較

* `gt(v1, v2)`: `v1 > v2`
* `gte(v1, v2)`: `v1 >= v2`
* `lt(v1, v2)`: `v1 < v2`
* `lte(v1, v2)`: `v1 <= v2`
* `eq(v1, v2)`：`v1 == v2`如果邏輯上相等，即使它們不是完全相同的字串，也視為 true。  您已經知道如何比較字串。
* `neq(v1, v2)`：`v1 != v2` 與 `eq` 相反。
* `cmp(v1, comparator, v2)`：傳入比較字串，該字串會呼叫上述對應的函式。  `"==="` 和 `"!=="` 會執行簡單的字串比較，但會包含在內，以求完整性。  如果提供不正確的比較字串，則會擲回。
* `compare(v1, v2)`：如果 `v1 == v2` 則傳回 `0`；或者如果 `v1` 較大，則傳回 `1`；或者如果 `v2` 較大，則傳回 `-1`。  如果傳遞至 `Array.sort()`，則以遞增順序排序。
* `rcompare(v1, v2)`：比較的反轉。  傳遞至 `Array.sort()` 時，以遞減順序排序版本的陣列。
* `diff(v1, v2)`：依版本類型傳回兩個版本之間的差異 (`major`、`premajor`、`minor`、`preminor`、`patch`、`prepatch` 或 `prerelease`)，如果版本相同則傳回 null。

### <a name="comparators"></a>比較子

* `intersects(comparator)`：如果比較子交集，則傳回 true

### <a name="ranges"></a>範圍

* `validRange(range)`：傳回有效範圍，如果無效則傳回 null
* `satisfies(version, range)`：如果版本符合範圍，則傳回 true。
* `maxSatisfying(versions, range)`：傳回清單中符合範圍的最高版本，如果都沒有符合則傳回 `null`。
* `minSatisfying(versions, range)`：傳回清單中符合範圍的最低版本，如果沒有則傳回 `null`。
* `minVersion(range)`：傳回可能符合指定範圍的最低版本。
* `gtr(version, range)`：如果版本大於範圍中所有可能的版本，則傳回 `true`。
* `ltr(version, range)`：如果版本小於範圍中所有可能的版本，則傳回 `true`。
* `outside(version, range, hilo)`：如果版本超出高或低方向的範圍界限，則傳回 true。  `hilo` 引數必須是字串 `'>'` 或 `'<'`。  (這是由 `gtr` 和 `ltr` 呼叫的函式。)
* `intersects(range)`：如果任何範圍比較子交集，則傳回 true

請注意，由於範圍可能是非連續的，因此版本可能不會是大於範圍、小於範圍、或者 *或* 符合範圍！  例如，範圍 `1.2 <1.2.9 || >2.0.0` 會在 `1.2.9` 和 `2.0.0` 之間有漏洞，因此版本 `1.2.10` 不會大於範圍 (因為 `2.0.1` 符合，也較高)，也不會小於範圍 (因為 `1.2.8` 符合，也較低)，也不會符合範圍。

如果您想要知道版本是否符合範圍，請使用 `satisfies(version, range)` 函式。

### <a name="coercion"></a>強制型轉

* `coerce(version)`：可能的話，將字串強制型轉為 SemVer

目標是將寬容的非 SemVer 字串轉譯至 SemVer。 它會尋找字串中的第一個數字，並取用至少符合部分 SemVer 的所有剩餘字元 (例如 `1`、`1.2`、`1.2.3`)，至最大允許的長度 (256 個字元)。  較長的版本只會被截斷 (`4.6.3.9.2-alpha2` 變成 `4.6.3`)。  所有周圍的文字會被忽略 (`v3.4 replaces v3.3.1` 變成 `3.4.0`)。  只有缺少數字的文字會強制型轉失敗 (`version one` 無效)。  任何考慮強制型轉的 SemVer 元件的長度上限為 16 個字元；較長的元件則會忽略 (`10000000000000000.4.7.4` 變成 `4.7.4`)。  任何 SemVer 元件的最大值為 `Number.MAX_SAFE_INTEGER || (2**53 - 1)`；值較高的元件則為無效 (`9999999999999999.4.7.4` 可能無效)。
