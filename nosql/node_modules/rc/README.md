---
ms.openlocfilehash: 4f70d9e1d8895757244ec8464f178ff3068a36bd
ms.sourcegitcommit: e739004291428ce83f14b9d49f1e9dfaa3762dde
ms.translationtype: HT
ms.contentlocale: zh-TW
ms.lasthandoff: 02/05/2022
ms.locfileid: "138050508"
---
# <a name="rc"></a>rc

適用於消極人員的不可設定組態載入程式。

## <a name="usage"></a>使用方式

唯一的選項是傳遞給 rc 您應用程式的名稱以及您的預設組態。

```javascript
var conf = require('rc')(appname, {
  //defaults go here.
  port: 2468,

  //defaults which are objects will be merged, not replaced
  views: {
    engine: 'jade'
  }
});
```

`rc` 會傳回與您指定預設值合併的組態選項。
如果您傳入預先定義的預設物件，則會變更：

```javascript
var conf = {};
require('rc')(appname, conf);
```

如果 `rc` 找到您的應用程式的任何組態檔，傳回的組態物件將會有包含其路徑的 `configs` 陣列：

```javascript
var appCfg = require('rc')(appname, conf);
appCfg.configs[0] // /etc/appnamerc
appCfg.configs[1] // /home/dominictarr/.config/appname
appCfg.config // same as appCfg.configs[appCfg.configs.length - 1]
```

## <a name="standards"></a>標準

提供您的應用程式名稱 (`appname`) 後，rc 會查看所有明顯的組態位置。

  * 由最低需求  _剖析的命令列引數 (例如 `--foo baz`，以及巢狀：`--foo.bar=baz`)_
  * 前置詞為 `${appname}_` 的環境變數
    * 或使用「\_\_」表示巢狀屬性 <br/> _(例如 `appname_foo__bar__baz` => `foo.bar.baz`)_
  * 如果您傳遞選項 `--config file`，則從該檔案傳遞
  * 本機 `.${appname}rc` 或第一個在 `./ ../ ../../ ../../../` 找到的結果等等。
  * `$HOME/.${appname}rc`
  * `$HOME/.${appname}/config`
  * `$HOME/.config/${appname}`
  * `$HOME/.config/${appname}/config`
  * `/etc/${appname}rc`
  * `/etc/${appname}/config`
  * 您傳入的預設物件。

找到的所有組態來源都會壓平合併成一個物件，讓此清單中 **較早** 的來源覆寫之後的來源。


## <a name="configuration-file-formats"></a>組態檔格式

組態檔 (例如 `.appnamerc`) 可能是 [json](http://json.org/example) 或 [ini](http://en.wikipedia.org/wiki/INI_file) 格式。 **不應該** 使用副檔名 (`.json` 或 `.ini`)。 下列範例組態是相等的：


#### <a name="formatted-as-ini"></a>格式化為 `ini`

```
; You can include comments in `ini` format if you want.

dependsOn=0.10.0


; `rc` has built-in support for ini sections, see?

[commands]
  www     = ./commands/www
  console = ./commands/repl


; You can even do nested sections

[generators.options]
  engine  = ejs

[generators.modules]
  new     = generate-new
  engine  = generate-backend

```

#### <a name="formatted-as-json"></a>格式化為 `json`

```javascript
{
  // You can even comment your JSON, if you want
  "dependsOn": "0.10.0",
  "commands": {
    "www": "./commands/www",
    "console": "./commands/repl"
  },
  "generators": {
    "options": {
      "engine": "ejs"
    },
    "modules": {
      "new": "generate-new",
      "backend": "generate-backend"
    }
  }
}
```

註解會透過 [strip-json-comments](https://github.com/sindresorhus/strip-json-comments) 從 JSON 組態中移除。

> 由於 ini 和 env 變數沒有類型的標準，因此您的應用程式需要針對字串做好準備。

若要確保布林值和數字的字串表示一律轉換成其適當的類型 (特別適用於如果您想要執行嚴格的 `===` 比較)，請考慮使用類似 [parse-strings-in-object](https://github.com/anselanza/parse-strings-in-object) 的模組，來包裝從 rc 傳回的組態物件。


## <a name="simple-example-demonstrating-precedence"></a>示範優先順序的簡單範例
假設您有類似此範例的應用程式 (請注意傳遞至 rc 的硬式編碼預設值)：
```
const conf = require('rc')('myapp', {
    port: 12345,
    mode: 'test'
});

console.log(JSON.stringify(conf, null, 2));
```
您也有 `config.json` 檔案，其中包含下列內容：
```
{
  "port": 9000,
  "foo": "from config json",
  "something": "else"
}
```
以及相同資料夾中的 `.myapprc` 檔案，其中包含下列內容：
```
{
  "port": "3001",
  "foo": "bar"
}
```
以下是各種命令的預期輸出：

`node .`
```
{
  "port": "3001",
  "mode": "test",
  "foo": "bar",
  "_": [],
  "configs": [
    "/Users/stephen/repos/conftest/.myapprc"
  ],
  "config": "/Users/stephen/repos/conftest/.myapprc"
}
```
*會保留硬式編碼物件的預設 `mode`，但 `.myapprc` 檔案會覆寫連接埠 (根據 appname 比對自動找到檔案)，並且新增`foo`。*


`node . --foo baz`
```
{
  "port": "3001",
  "mode": "test",
  "foo": "baz",
  "_": [],
  "configs": [
    "/Users/stephen/repos/conftest/.myapprc"
  ],
  "config": "/Users/stephen/repos/conftest/.myapprc"
}
```
*與上述結果相同，但 `foo` 會遭覆寫，因為命令列引數的優先順序高於 `.myapprc` 檔案。*

`node . --foo barbar --config config.json`
```
{
  "port": 9000,
  "mode": "test",
  "foo": "barbar",
  "something": "else",
  "_": [],
  "config": "config.json",
  "configs": [
    "/Users/stephen/repos/conftest/.myapprc",
    "config.json"
  ]
}
```
*現在 `port` 來自 `config.json` 指定的檔案 (覆寫 `.myapprc` 的值)，而即使已在 `config.json` 檔案中指定 `foo` 值，仍會由命令列覆寫。*
 


## <a name="advanced-usage"></a>進階使用方式

#### <a name="pass-in-your-own-argv"></a>傳入您自己的 `argv`

您可以將自己的 `argv` 作為第三個引數傳入 `rc`。  以免您想要 [使用自己的命令列選擇剖析器](https://github.com/dominictarr/rc/pull/12)。

```javascript
require('rc')(appname, defaults, customArgvParser);
```

## <a name="pass-in-your-own-parser"></a>傳入您自己的剖析器

如果您有使用非標準剖析器的特殊需求，您可以藉由傳入剖析器作為第 4 個引數來執行此動作。
(將第 3 個保留為 null，以取得預設引數剖析器)

```javascript
require('rc')(appname, defaults, null, parser);
```

這也可以用來強制更嚴格的格式，例如僅限 strict、有效的 JSON。

## <a name="note-on-performance"></a>效能注意事項

`rc` 正在執行 `fs.statSync` -- 因此請確定您未在經常性存取層的程式碼路徑中使用 (例如要求處理常式) 


## <a name="license"></a>授權

在雙子句 BSD 授權、MIT 授權或 Apache 授權 (版本 2.0) 下的多重授權
