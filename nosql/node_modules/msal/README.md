---
ms.openlocfilehash: 4f36d4681facd228c63b48050973040e9785d30f
ms.sourcegitcommit: e739004291428ce83f14b9d49f1e9dfaa3762dde
ms.translationtype: HT
ms.contentlocale: zh-TW
ms.lasthandoff: 02/05/2022
ms.locfileid: "138050572"
---

<a name="microsoft-authentication-library-for-javascript-msaljs"></a>適用於 JavaScript 的 Microsoft 驗證程式庫 (MSAL.js)
=========================================================

| [快速入門](https://docs.microsoft.com/azure/active-directory/develop/guidedsetups/active-directory-javascriptspa)| [AAD Docs](https://aka.ms/aaddevv2) | [程式庫參考](https://azuread.github.io/microsoft-authentication-library-for-js/ref/modules/_azure_msal.html) | [支援](README.md#community-help-and-support) | [範例](https://github.com/AzureAD/microsoft-authentication-library-for-js/wiki/Samples)
| --- | --- | --- | --- | --- |

⚠️⚠️⚠️ 此程式庫已不再收到新功能，只會收到重大錯誤和安全性修正。 所有新應用程式應該改用[@azure/msal-browser](https://www.npmjs.com/package/@azure/msal-browser) (英文)。 ⚠️⚠️⚠️

適用於 MSAL 的 JavaScript 可讓在網頁瀏覽器執行的用戶端 JavaScript Web 應用程式，透過 [Azure AD B2C](https://docs.microsoft.com/azure/active-directory-b2c/active-directory-b2c-overview#identity-providers) 服務，來驗證 [Azure AD](https://docs.microsoft.com/azure/active-directory/develop/v2-overview) 與學校帳戶 (AAD)、Microsoft 個人帳戶 (MSA) 和 Facebook、Google、LinkedIn、Microsoft 帳戶等社交識別提供者的使用者。 它也可讓您的應用程式取得權杖，以存取 [Microsoft Cloud](https://www.microsoft.com/enterprise) 服務，例如 [Microsoft Graph](https://graph.microsoft.io) (英文)。

[![npm 版本](https://img.shields.io/npm/v/msal.svg?style=flat)](https://www.npmjs.com/package/msal) (英文) 
[![npm 版本](https://img.shields.io/npm/dm/msal.svg)](https://nodei.co/npm/msal/)
[![codecov](https://codecov.io/gh/AzureAD/microsoft-authentication-library-for-js/branch/dev/graph/badge.svg?flag=msal-core)](https://codecov.io/gh/AzureAD/microsoft-authentication-library-for-js)

## <a name="installation"></a>安裝

### <a name="via-npm"></a>透過 NPM：

    npm install msal

## <a name="via-cdn"></a>透過 CDN：

<!-- CDN_LATEST -->
```html
<script type="text/javascript" src="https://alcdn.msauth.net/lib/1.4.11/js/msal.min.js"></script>
```

如需 CDN 使用方式的[完整詳細資料和最佳做法](https://github.com/AzureAD/microsoft-authentication-library-for-js/blob/dev/lib/msal-core/docs/cdn.md) (英文)，請參閱我們的文件。

## <a name="what-to-expect-from-this-library"></a>本程式庫的預期內容
JAVAscript 上的 Msal 支援是程式庫的集合。 `msal-core` 或 `msal`，是架構無從驗證的核心程式庫。 一旦核心 1.x+ 穩定後，我們將使用最新的 1.x 改進功能來帶入 `msal-angular` 程式庫。  我們計畫根據架構的使用趨勢，以及指出 Angular 2+ 而非 Angular 1x 之採用率提升的程式庫，來取代 `msal-angularjs` 的支援。 在目前的程式庫符合標準之後，我們將開始平衡新功能要求，以及 `react` 和 `node.js` 等新平台。

我們的目標是與社群非常妥善地溝通，並考慮其意見。 我們想要取得每月次要發行排程，並視需要提供修補檔。  我們將會努力達到我們期望的通訊、規劃和細微性層級。

請查看我們的[藍圖](https://github.com/AzureAD/microsoft-authentication-library-for-js/wiki#roadmap) (英文)，了解我們正在處理的工作，以及接下來要追蹤的項目。

## <a name="oauth-20-and-the-implicit-flow"></a>OAuth 2.0 和隱含流程

Msal 會實作[隱含授與流程](https://docs.microsoft.com/azure/active-directory/develop/v2-oauth2-implicit-grant-flow)，如 OAuth 2.0 通訊協定所定義，且符合 [OpenID](https://docs.microsoft.com/azure/active-directory/develop/v2-protocols-oidc) 的規範。

我們的目標是，程式庫會將足夠的通訊協定抽象化，以便您獲得隨插即用驗證，但請務必從安全性觀點來了解隱含流程。
隱含流程會在網頁瀏覽器的內容中執行，無法安全地管理用戶端密碼。 它已針對單頁應用程式進行最佳化，而且用戶端與伺服器之間有一個較少的躍點，因此權杖會直接傳回瀏覽器。 這些層面自然會讓隱含流程較不安全。
這些安全性考慮會因標準做法而降低，例如使用短期權杖 (因此不會傳回任何重新整理權杖)、需要應用程式已註冊重新導向 URI 的程式庫、符合要求與回應的程式庫，以及具有唯一 nonce 和 state 參數的回應。

## <a name="cache-storage"></a>快取儲存體

我們針對 Msal 提供兩種儲存體方法，`localStorage` 以及 `sessionStorage`。  我們建議您使用 `sessionStorage` (請參閱：設定)，因為在儲存使用者所取得的權杖時比較安全，但 `localStorage` 會讓您在索引標籤和使用者工作階段之間進行 單一登入。  我們鼓勵您探索選項，並為您的應用程式做出最佳決策。

### <a name="forcerefresh-to-skip-cache"></a>forceRefresh 跳過快取
如果您想要跳過快取的權杖並移至伺服器，請將布林值 `forceRefresh` 傳入 `AuthenticationParameters` 用來提出登入/權杖要求的 物件。 **警告：** 不應用為預設，因為這會對應用程式效能造成影響。  依賴快取功能可讓使用者獲得更好的體驗，而應該在您知道目前快取的資料沒有最新資訊的情況下再跳過快取。  範例：使用者需要具有更新角色的新權杖時，將角色新增給使用者的管理員工具。

## <a name="usage"></a>使用方式
下列範例會逐步引導您將使用者登入，並取得要用於 Microsoft Graph Api 的權杖。

#### <a name="prerequisites"></a>Prerequisites

在使用 MSAL.js 之前，您必須 [在 Azure AD 中註冊應用程式](https://docs.microsoft.com/azure/active-directory/develop/quickstart-register-app)，以取得有效的 `clientId` 設定，以及註冊應用程式將接受重新導向流量的路由。

#### <a name="1-instantiate-the-useragentapplication"></a>1.將 UserAgentApplication 具現化

`UserAgentApplication` 可以使用各種不同選項來設定，在我們的 [Wiki](https://github.com/AzureAD/microsoft-authentication-library-for-js/wiki/MSAL.js-1.0.0-api-release#configuration-options) (英文) 中有詳細說明，但唯一的必要參數是 `auth.clientId`。

將執行個體具現化後，如果您打算在 MSAL 1.2.x 或更早版本 (`loginRedirect` 和 `acquireTokenRedirect`) 中使用重新導向流程，您必須在 `authCallback = function(AuthError, AuthResponse)` 使用 `handleRedirectCallback(authCallback)` 註冊回呼處理常式。 從 MSAL 1.3.0 起，這是選擇性的。 在驗證要求順利完成或失敗之後，會呼叫回呼函式。 快顯流程不需要這樣做，因為它們會傳回 Promise。

```JavaScript
    import * as Msal from "msal";
    // if using cdn version, 'Msal' will be available in the global scope

    const msalConfig = {
        auth: {
            clientId: 'your_client_id'
        }
    };

    const msalInstance = new Msal.UserAgentApplication(msalConfig);

    msalInstance.handleRedirectCallback((error, response) => {
        // handle redirect response or error
    });

```

如需組態選項的詳細資訊，請參閱 [使用 MSAL.js 將用戶端應用程式初始化](https://docs.microsoft.com/azure/active-directory/develop/msal-js-initializing-client-applications)。

#### <a name="2-login-the-user"></a>2.將使用者登入

您的應用程式必須使用 `loginPopup` 或 `loginRedirect` 方法將使用者登入，才能建立使用者內容。

當已呼叫登入方法，並且 Azure AD 服務已完成使用者的驗證時，會傳回[識別碼權杖](https://docs.microsoft.com/azure/active-directory/develop/id-tokens) (部分機器翻譯)，用來識別具有一些基本資訊的使用者。

當您將使用者登入時，您可以傳入使用者預先同意登入的範圍，但這不是必要的。 請注意，同意登入範圍不會傳回這些範圍的 access_token，但讓您有機會以無訊息模式取得傳入這些範圍的權杖，而不會進一步與使用者互動。

最佳做法是只在需要的時候要求範圍，也就是動態同意的概念。 雖然這可為您的應用程式中的使用者建立更加互動式的同意，它也能減少使用者暫時擱置，而使用者可能不放心授與他們尚未使用的功能的大型權限清單。

AAD 一次只允許您同意 3 個資源，不過您可以要求資源內的許多範圍。
當使用者提出登入要求時，您可以傳入多個資源及其對應的範圍，因為 AAD 會發行預先同意這些範圍的 idToken。 不過，acquireToken 呼叫只適用於一個資源/多個範圍。 如果您需要存取多個資源，請針對每個資源進行個別的 acquireToken 呼叫。

```JavaScript
   var loginRequest = {
       scopes: ["user.read", "mail.send"] // optional Array<string>
   };

    msalInstance.loginPopup(loginRequest)
        .then(response => {
            // handle response
        })
        .catch(err => {
            // handle error
        });

```

##### <a name="ssosilent"></a>ssoSilent

如果您確信使用者具有現有工作階段，而且想要在不提示進行互動的情況下建立使用者內容，您可以使用`ssoSilent` 和`loginHint` 或 `sid` (作為 [選用宣告](https://docs.microsoft.com/azure/active-directory/develop/active-directory-optional-claims)) 進行叫用，而 MSAL 會嘗試以無訊息模式單一登入至現有的工作階段，並建立使用者內容。

請注意，如果指定的 `loginHint` 或 `sid` 沒有作用中的工作階段，則會擲回錯誤，應該藉由叫用互動式登入方法 (`loginPopup` 或 `loginRedirect`) 來控制。

範例：

```js
const ssoRequest = {
    loginHint: "user@example.com"
};

msalInstance.ssoSilent(ssoRequest)
    .then(response => {
        // session silently established
    })
    .catch(error => {
        // handle error by invoking an interactive login method
        msalInstance.loginPopup(ssoRequest);
    });
```

#### <a name="3-get-an-access-token-to-call-an-api"></a>3.取得存取權杖以呼叫 API

在 MSAL 中，您可以使用 `acquireTokenSilent` 方法取得應用程式需要呼叫的 API 存取權杖，此方法會向 Azure AD 發出無訊息要求 (而不以 UI 提示使用者)，以取得存取權杖。 Azure AD 服務接著會傳回[存取權杖](https://docs.microsoft.com/azure/active-directory/develop/access-tokens)，其中包含使用者同意的範圍，以允許您的應用程式安全地呼叫 API。

您可以使用 `acquireTokenRedirect` 或 `acquireTokenPopup` 來啟動互動式要求，不過，如果您因為互動必要的錯誤而無法以無訊息模式取得權杖，則最好作法是只顯示互動式體驗。 如果您使用互動式權杖呼叫，它必須符合應用程式中所使用的登入方法。 (`loginPopup`=> `acquireTokenPopup`, `loginRedirect` => `acquireTokenRedirect`).

如果 `acquireTokenSilent` 呼叫失敗並出現 `InteractionRequiredAuthError` 類型的錯誤，則您必須啟動互動式要求。  發生的原因有許多種，包括已撤銷的範圍、過期的權杖或密碼變更。

`acquireTokenSilent` 會在快取中尋找有效的權杖，如果它接近到期或不存在，則會自動嘗試重新整理。

如需參考，請參閱[要求和回應資料類型](https://github.com/AzureAD/microsoft-authentication-library-for-js/wiki/MSAL.js-1.0.0-api-release#signing-in-and-getting-tokens-with-msaljs) (英文)。

```JavaScript
    // if the user is already logged in you can acquire a token
    if (msalInstance.getAccount()) {
        var tokenRequest = {
            scopes: ["user.read", "mail.send"]
        };
        msalInstance.acquireTokenSilent(tokenRequest)
            .then(response => {
                // get access token from response
                // response.accessToken
            })
            .catch(err => {
                // could also check if err instance of InteractionRequiredAuthError if you can import the class.
                if (err.name === "InteractionRequiredAuthError") {
                    return msalInstance.acquireTokenPopup(tokenRequest)
                        .then(response => {
                            // get access token from response
                            // response.accessToken
                        })
                        .catch(err => {
                            // handle error
                        });
                }
            });
    } else {
        // user is not logged in, you will need to log them in to acquire a token
    }
```

#### <a name="4-use-the-token-as-a-bearer-in-an-http-request-to-call-the-microsoft-graph-or-a-web-api"></a>4.在 HTTP 要求中使用權杖作為持有人，以呼叫 Microsoft Graph 或 Web API

```JavaScript
    var headers = new Headers();
    var bearer = "Bearer " + token;
    headers.append("Authorization", bearer);
    var options = {
         method: "GET",
         headers: headers
    };
    var graphEndpoint = "https://graph.microsoft.com/v1.0/me";

    fetch(graphEndpoint, options)
        .then(resp => {
             //do something with response
        });
```

您可以進一步閱讀 [MSAL Wiki](https://github.com/AzureAD/microsoft-authentication-library-for-js/wiki) (英文) 了解 MSAL.js 功能的詳細資料，並尋找完整的 [程式碼範例](https://github.com/AzureAD/microsoft-authentication-library-for-js/wiki/Samples) (英文)。

## <a name="security-reporting"></a>安全性報告

如果您發現程式庫或服務的安全性問題，請向 [secure@microsoft.com](mailto:secure@microsoft.com) 報告，細節越詳盡越好。 您的提交可望符合 [Microsoft Bounty](http://aka.ms/bugbounty) 賞金計劃的資格。 請勿將安全性問題張貼至「GitHub 問題」，或任何其他公用網站。 我們會在收到資訊後盡快與您連絡。 我們鼓勵您造訪 [此頁面](https://technet.microsoft.com/security/dd252948) 並訂閱資訊安全摘要報告警示，以在安全性事件發生時收到通知。

## <a name="license"></a>授權

Copyright (c) Microsoft Corporation。  著作權所有，並保留一切權利。 根據 MIT 授權 (以下簡稱「授權」) 進行授權；

## <a name="we-value-and-adhere-to-the-microsoft-open-source-code-of-conduct"></a>我們重視並遵守 Microsoft 開放原始碼管理辦法

此專案採用了 [Microsoft 開放原始碼管理辦法](https://opensource.microsoft.com/codeofconduct/)。 如需詳細資訊，請參閱[管理辦法常見問題集 (英文)](https://opensource.microsoft.com/codeofconduct/faq/)。如果有任何其他疑問或意見，請連絡 [opencode@microsoft.com](mailto:opencode@microsoft.com)。
