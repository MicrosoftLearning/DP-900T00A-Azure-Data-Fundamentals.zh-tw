---
ms.openlocfilehash: 841a4ef811cc186a2302309fbbc4a380d1ba5cbd
ms.sourcegitcommit: e739004291428ce83f14b9d49f1e9dfaa3762dde
ms.translationtype: HT
ms.contentlocale: zh-TW
ms.lasthandoff: 02/05/2022
ms.locfileid: "138050432"
---
# <a name="tar-fs"></a>tar-fs

[tar 資料流](https://github.com/mafintosh/tar-stream)的檔案系統stream。

```
npm install tar-fs
```

[![組建狀態](https://secure.travis-ci.org/mafintosh/tar-fs.png)](http://travis-ci.org/mafintosh/tar-fs)

## <a name="usage"></a>使用方式

tar-fs 可讓您將目錄封裝成 tarball，並將 tarball 擷取到目錄中。

它不會為您 gunzip，因此如果您想要用來擷取`.tar.gz`，則除了 gunzip，還需要使用類似 [gunzip-maybe](https://github.com/mafintosh/gunzip-maybe) 之類的項目。

``` js
var tar = require('tar-fs')
var fs = require('fs')

// packing a directory
tar.pack('./my-directory').pipe(fs.createWriteStream('my-tarball.tar'))

// extracting a directory
fs.createReadStream('my-other-tarball.tar').pipe(tar.extract('./my-other-directory'))
```

若要在封裝或擷取時忽略各種檔案，請將 ignore 函式新增至選項。 `ignore` 也是 `filter` 的別名。 此外，如果您在擷取時使用忽略，則會取得 `header`。
如此一來，您也可以依中繼資料進行篩選。

``` js
var pack = tar.pack('./my-directory', {
  ignore: function(name) {
    return path.extname(name) === '.bin' // ignore .bin files when packing
  }
})

var extract = tar.extract('./my-other-directory', {
  ignore: function(name) {
    return path.extname(name) === '.bin' // ignore .bin files inside the tarball when extracing
  }
})

var extractFilesDirs = tar.extract('./my-other-other-directory', {
  ignore: function(_, header) {
    // pass files & directories, ignore e.g. symlinks
    return header.type !== 'file' && header.type !== 'directory'
  }
})
```

您也可以使用 `entries` 選項指定要封裝的項目

```js
var pack = tar.pack('./my-directory', {
  entries: ['file1', 'subdir/file2'] // only the specific entries will be packed
})
```

如果您想要在封裝/擷取時修改標題，請將對應函式新增至選項

``` js
var pack = tar.pack('./my-directory', {
  map: function(header) {
    header.name = 'prefixed/'+header.name
    return header
  }
})

var extract = tar.extract('./my-directory', {
  map: function(header) {
    header.name = 'another-prefix/'+header.name
    return header
  }
})
```

同樣地，若想要修改輸入/輸出檔案資料流，您可以使用 `mapStream`

``` js
var pack = tar.pack('./my-directory', {
  mapStream: function(fileStream, header) {
    // NOTE: the returned stream HAS to have the same length as the input stream.
    // If not make sure to update the size in the header passed in here.
    if (path.extname(header.name) === '.js') {
      return fileStream.pipe(someTransform)
    }
    return fileStream;
  }
})

var extract = tar.extract('./my-directory', {
  mapStream: function(fileStream, header) {
    if (path.extname(header.name) === '.js') {
      return fileStream.pipe(someTransform)
    }
    return fileStream;
  }
})
```

設定 `options.fmode` 和 `options.dmode` 以確保擷取的檔案/目錄具有對應的模式

``` js
var extract = tar.extract('./my-directory', {
  dmode: parseInt(555, 8), // all dirs should be readable
  fmode: parseInt(444, 8) // all files should be readable
})
```

當您在 *nix/windows 之間封裝/解除封裝 tarball 以確保可以讀取所有已解除封裝的檔案/目錄時，`dmode` 和 `fmode` 非常有用。

或者，您可以設定 `options.readable` 和/或 `options.writable` 將 dmode 和 fmode 設定為可讀取/可寫入。

``` js
var extract = tar.extract('./my-directory', {
  readable: true, // all dirs and files should be readable
  writable: true, // all dirs and files should be writable
})
```

如果您想要忽略因為不支援的項目類型 (例如裝置檔案) 而發生的錯誤，請將 `options.strict` 設定為 `false`

若要取值符號連結 (封裝符號連結的內容，而不是連結本身)，請將 `options.dereference` 設定為 `true`。

## <a name="copy-a-directory"></a>複製目錄

複製具有許可權和 mtime 未受損的目錄，簡單得就像

``` js
tar.pack('source-directory').pipe(tar.extract('dest-directory'))
```

## <a name="interaction-with-tar-stream"></a>與 [`tar-stream`](https://github.com/mafintosh/tar-stream) 互動

使用 `finalize: false` 和 `finish` 勾點，讓套件資料流保持開啟，供進一步的項目使用 (請參閱 [`tar-stream#pack`](https://github.com/mafintosh/tar-stream#packing))，並使用 `pack` 傳遞現有的套件資料流。

``` js
var mypack = tar.pack('./my-directory', {
  finalize: false,
  finish: function(sameAsMypack) {
    mypack.entry({name: 'generated-file.txt'}, "hello")
    tar.pack('./other-directory', {
      pack: sameAsMypack
    })
  }
})
```


## <a name="performance"></a>效能

封裝並擷取包含 2496 個目錄和 2398 個檔案的 6.1 GB 會在我的 Macbook Air 上產生下列結果。
[請參閱此基準](https://gist.github.com/mafintosh/8102201)

* tar-fs:34.261 秒
* [節點類型](https://github.com/isaacs/node-tar)：366.123 秒 (或 10 倍慢)

## <a name="license"></a>授權

MIT
